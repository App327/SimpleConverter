<!DOCTYPE html>
<html lang="ru" dir="ltr">
 <head>
  <meta charset="utf-8" />
  <title>SimpleConverter</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <style type="text/css">
:root {
 --settings-icon: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjMDAwMDAwIj48cGF0aCBkPSJtMzcwLTgwLTE2LTEyOHEtMTMtNS0yNC41LTEyVDMwNy0yMzVsLTExOSA1MEw3OC0zNzVsMTAzLTc4cS0xLTctMS0xMy41di0yN3EwLTYuNSAxLTEzLjVMNzgtNTg1bDExMC0xOTAgMTE5IDUwcTExLTggMjMtMTV0MjQtMTJsMTYtMTI4aDIyMGwxNiAxMjhxMTMgNSAyNC41IDEydDIyLjUgMTVsMTE5LTUwIDExMCAxOTAtMTAzIDc4cTEgNyAxIDEzLjV2MjdxMCA2LjUtMiAxMy41bDEwMyA3OC0xMTAgMTkwLTExOC01MHEtMTEgOC0yMyAxNXQtMjQgMTJMNTkwLTgwSDM3MFptMTEyLTI2MHE1OCAwIDk5LTQxdDQxLTk5cTAtNTgtNDEtOTl0LTk5LTQxcS01OSAwLTk5LjUgNDFUMzQyLTQ4MHEwIDU4IDQwLjUgOTl0OTkuNSA0MVoiLz48L3N2Zz4=');
}

body {
 color: rgb(30, 30, 30);
 font-family: sans-serif;
}

a {
 color: dodgerblue;
 text-decoration: none;
}

a:hover {
 text-decoration: underline;
}

a:active {
 color: royalblue;
}

h1 {
 color: darkblue;
 user-select: none;
}

#conv-type {
 width: 100%;
 padding: 5px;
 border: 2px solid rgb(200, 200, 200);
 background: rgb(240, 240, 240);
}
#conv-type:hover {
 background: rgb(220, 220, 220);
}
#conv-type:active {
 background: rgb(180, 180, 180);
}
#conv-type:focus {
 outline: 1px dashed royalblue;
 outline-offset: -2px;
}

code {
 padding: 2px;
 border-radius: 2px;
 background: rgb(240, 240, 240);
 border: 1px solid rgb(220, 220, 220);
}

button, select, textarea, input {
 font-family: inherit;
}

button, select {
 user-select: none;
 cursor: pointer;
 -webkit-tap-highlight-color: transparent;
}

button[disabled] {
 cursor: not-allowed;
}

.from-to {
 display: flex;
 flex-direction: row;
 align-items: center;
 border-top: 1px solid silver;
 border-bottom: 1px solid silver;
 padding: 10px;
 width: calc(100% - 20px);
 overflow: auto;
}

.from-to p {
 margin: 0;
}

.from-to .unit {
 margin-right: 5px;
 border: 1px solid silver;
 background: white;
 padding: 5px;
 border-radius: 5px;
 width: 150px;
 flex-shrink: 0;
}
.from-to .unit:hover {
 background: rgb(240, 240, 240);
 outline: 1px solid silver;
}
.from-to .unit:active {
 background: rgb(210, 210, 210);
}
.from-to .unit:focus {
 outline: 2px solid dodgerblue;
}

*[dir="rtl"] .from-to .unit {
 margin-right: 0;
 margin-left: 5px;
}

.from-to .value {
 margin-left: 5px;
 display: flex;
 flex-direction: row;
 align-items: center;
 flex-shrink: 0;
}

*[dir="rtl"] .value {
 margin-left: 0;
 margin-right: 5px;
}

.from-to .value .u {
 margin-left: 2.5px;
 font-size: 0.8rem;
 color: grey;
 user-select: none;
}

*[dir="rtl"] .from-to .value .u {
 margin-left: 0;
 margin-right: 2.5px;
}

.from-to.from .value input {
 margin-right: 2.5px;
 padding: 5px;
 width: 100px;
 border: none;
 background: rgb(240, 240, 240);
 border-radius: 5px;
 caret-color: darkblue;
}
.from-to.from .value input:hover {
 background: rgb(230, 230, 230);
}
.from-to.from .value input:active {
 background: rgb(200, 200, 200);
}
.from-to.from .value input:focus {
 outline: 2px solid dodgerblue;
}

*[dir="rtl"] .from-to.from .value input {
 margin-right: 0;
 margin-left: 2.5px;
}

.from-to.to .v {
 font-weight: 700;
}

.settings-btn {
 border: none;
 height: 50px;
 width: 50px;
 position: absolute;
 top: 0;
 right: 0;
 padding: 0;
 background-color: white;
 background-image: var(--settings-icon);
 background-repeat: no-repeat;
 background-position: center;
 background-size: 30px;
}
.settings-btn:hover {
 background: rgba(100, 100, 100, 0.2);
 background-image: var(--settings-icon);
 background-repeat: no-repeat;
 background-position: center;
 background-size: 30px;
}
.settings-btn:active {
 background: rgba(100, 100, 100, 0.5);
 background-image: var(--settings-icon);
 background-repeat: no-repeat;
 background-position: center;
 background-size: 30px;
}
.settings-btn:focus {
 outline: 2px solid dodgerblue;
 outline-offset: -2px;
}

.settings-btn.opened {
 background-image: none;
 font-size: 2.0rem;
}

*[dir="rtl"] .settings-btn {
 left: 0;
 right: auto;
}

.win {
 position: fixed;
 width: calc(100% - 10px);
 min-height: 100px;
 max-height: calc(100% - 120px);
 background: white;
 left: 0;
 top: 50%;
 transform: translateY(-50%);
 overflow: auto;
 box-shadow: 0 0 7px silver;
 padding: 5px;
 user-select: none;
}

.win h2 {
 font-weight: 600;
 border-bottom: 1px solid silver;
 padding: 0 5px;
 width: calc(100% - 10px);
 margin: 5px 0 10px 0;
}

.win h3, .win p {
 margin: 5px 0;
}

.win p {
 font-size: 0.9rem;
}

.win h2.has-close-btn {
 display: flex;
 flex-direction: row;
 align-items: center;
 justify-content: space-between;
 padding-bottom: 5px;
}

.win h2.has-close-btn .text {
 margin-right: 5px;
}

.win h2.has-close-btn .close {
 margin-left: 5px;
 height: 30px;
 width: 30px;
 border: none;
 border-radius: 5px;
 background: rgb(240, 240, 240);
 padding: 0;
 font-size: 20px;
}

*[dir="rtl"] .win h2.has-close-btn .text {
 margin-left: 5px;
 margin-right: 0;
}

*[dir="rtl"] .win h2.has-close-btn .close {
 margin-left: 0;
 margin-right: 5px;
}

.win h2.has-close-btn .close:hover {
 background: rgb(220, 220, 220);
}

.win h2.has-close-btn .close:active {
 background: rgb(190, 190, 190);
}

.win h2.has-close-btn .close:focus {
 outline: 2px solid deepskyblue;
}

#settings .datapack-upload {
 display: flex;
 flex-direction: row;
 align-items: center;
 padding: 5px;
 width: calc(100% - 10px);
 overflow: auto;
}

#settings .datapack-upload .file-inp {
 margin-right: 5px;
}

*[dir="rtl"] #settings .datapack-upload .file-inp {
 margin-left: 5px;
 margin-right: 0;
}

#settings .datapack-upload .file-inp::file-selector-button {
 border: 1px solid silver;
 border-radius: 5px;
 padding: 5px 10px;
 background: rgb(250, 250, 250);
}

#settings .datapack-upload .file-inp::file-selector-button:hover {
 background: rgb(230, 230, 230);
}

#settings .datapack-upload .file-inp::file-selector-button:active {
 background: rgb(200, 200, 200);
 border: 1px solid grey;
}

#settings .datapack-upload .file-inp::file-selector-button:focus {
 outline: 1px dashed royalblue;
 outline-offset: -4px;
}

#settings .datapack-upload .apply-btn {
 padding: 5px 10px;
 background: dodgerblue;
 color: white;
 border: none;
 border-radius: 5px;
 margin-left: 5px;
}

#settings .datapack-upload .apply-btn:hover {
 background: royalblue;
}

#settings .datapack-upload .apply-btn:active {
 background: rgb(35, 75, 195);
}

*[dir="rtl"] #settings .datapack-upload .apply-btn {
 margin-left: 0;
 margin-right: 5px;
}

#settings .datapack-upload .apply-btn:focus {
 outline: 2px solid skyblue;
}

#settings .datapack-upload .apply-btn[disabled] {
 background: silver;
}

#settings .datapack-reset-btn {
 margin: 5px;
 padding: 2.5px 7.5px;
 border-radius: 5px;
 border: 1px solid silver;
 background: white;
 color: darkblue;
}

#settings .datapack-reset-btn:hover {
 background: rgb(230, 230, 230);
}

#settings .datapack-reset-btn:active {
 background: rgb(200, 200, 200);
 border: 1px solid grey;
}

#settings .datapack-reset-btn:focus {
 outline: 2px solid skyblue;
}

#settings .datapack-reset-btn[disabled] {
 background: rgb(240, 240, 240);
 color: grey;
 border: 1px solid lightgrey;
}
  </style>
 </head>
 <body>
  <button class="settings-btn" id="settings-btn" onclick="showSettings()"></button>
  <h1>SimpleConverter</h1>
  <div id="settings" class="win" style="display: none;">
   <h2>Настройки</h2>
   <h3>Загрузка пакета данных</h3>
   <p>Здесь вы можете загрузить JSON-файл с пакетом данных.</p>
   <div class="datapack-upload"><input type="file" id="settings-custom-conv-data-inp" accept="application/json" class="file-inp" /><button onclick="loadCustomConvertData()" id="settings-custom-conv-data-btn" class="apply-btn" disabled>Применить</button></div>
   <button onclick="resetConvertData()" id="settings-reset-conv-data-btn" class="datapack-reset-btn" disabled>Вернуть стандартные данные</button>
   <hr noshade color="silver" />
   <h3>О программе</h3>
   <p>SimpleConverter 1.2 <a href="javascript:showVersionChanges()">[список изменений]</a></p>
   <p><i>Дата выпуска версии:</i> 31 янв 2026</p>
   <p><a href="https://www.github.com/App327/SimpleConverter" class="external">GitHub</a></p>
   <p>© App327, 2025–2026</p>
  </div>
  <div id="changes" class="win" style="display: none;">
   <h2 class="has-close-btn"><span class="text">Список изменений: v1.2</span> <button class="close" onclick="closeVersionChanges()">×</button></h2>
   <p>Что нового в SimpleConverter версии 1.2 (изменения перечислены в порядке их реализации):</p>
   <ul>
    <li>теперь у окон будут добавляться полосы прокрутки, если они слишком большие и не влезают в окно браузера;</li>
    <li>добавлено это окно (со списком изменений в версии);</li>
    <li>в конвертер «Площадь» добавлена новая единица измерения — <i>квадратные километры (км²)</i></i>;</li>
    <li>исправлен баг, из-за которого не происходит переконвертация при изменении целевой/исходной единицы измерения;</li>
    <li>исправлен баг, из-за которого при соответствии исходной и целевой единиц измерения они не менялись местами;</li>
    <li>теперь у отключённых кнопок будет показываться курсор в виде значка недоступности;</li>
    <li>у поля ввода исходного значения в конвертере текстовый курсор теперь тёмно-синего цвета;</li>
    <li>добавлены стили у кнопок в разделе «Загрузка пакета данных» в настройках;</li>
    <li>теперь для JSON-пакетов данных необходимо наличие поля <code>"format": 1</code>;</li>
    <li>другие незначительные технические изменения.</li>
   </ul>
  </div>
  <select id="conv-type" onchange="changeConverter()"></select>
  <div id="converter">
  </div>

  <script type="application/javascript">
let t = document.getElementById('conv-type');
let c = document.getElementById('converter');

let conv = {
 1: {
  'name': 'длина',
  'units': ['см', 'м', 'км'],
  'units_full': ['сантиметры', 'метры', 'километры'],
  'formulas': {
   'см-м': '$ / 100',
   'м-см': '$ * 100',
   'см-км': '$ / 100000',
   'м-км': '$ / 1000',
   'км-м': '$ * 1000',
   'км-см': '$ * 100000'
  }
 },
 2: {
  'name': 'площадь',
  'units': ['см²', 'м²', 'км²'],
  'units_full': ['квадратные сантиметры', 'квадратные метры', 'квадратные километры'],
  'formulas': {
   'см²-м²': '$ / 10000',
   'м²-см²': '$ * 10000',
   'см²-км²': '$ / 10000000000',
   'м²-км²': '$ / 1000000',
   'км²-м²': '$ * 1000000',
   'км²-см²': '$ * 10000000000'
  }
 },
 3: {
  'name': 'масса',
  'units': ['г', 'кг'],
  'units_full': ['граммы', 'килограммы'],
  'formulas': {
   'г-кг': '$ / 1000',
   'кг-г': '$ * 1000'
  }
 }
};

let defaultConvData = conv;

let curFrom = 0;
let curTo = 1;

function updateTypes() {
 let opt = '';
 for (let i = 0; i < Object.keys(conv).length; i++) {
  let id = Object.keys(conv)[i];
  let c = conv[id];
  let name = upperCaseFirst(c['name']);
  opt += '<option value="' + id + '">' + name + '</option>';
 }
 t.innerHTML = opt;
}

function changeConverter() {
 curFrom = 0;
 curTo = 1;
 let ct = conv[t.value];
 if (!ct) {
  c.innerHTML = '<p>Конвертер недоступен. <code>E1</code></p>';
  return false;
 }
 let html = '<h3>Конвертер: ' + ct.name + '</h3>';
 html += '<div class="from-to from"><select id="cc-from-u" onclick="changeFromUnit(true)" class="unit">';
 for (let i = 0; i < ct.units_full.length; i++) {
  let s = '';
  if (i === curFrom) {
   s = ' selected';
  }
  html += '<option value="' + i + '"' + s + '>' + upperCaseFirst(ct.units_full[i]) + ' (' + ct.units[i] + ')</option>';
 }
 html += '</select> <div class="value"><input type="number" id="cc-from-v" oninput="convert()" onchange="convert()" placeholder="123" value="1" /> <p class="u" id="cc-from-ut">' + ct.units[curFrom] + '</p></div></div>';
 html += '<div class="from-to to"><select id="cc-to-u" onclick="changeToUnit(true)" class="unit">';
 for (let i = 0; i < ct.units_full.length; i++) {
  let s = '';
  if (i === curTo) {
   s = ' selected';
  }
  html += '<option value="' + i + '"' + s + '>' + upperCaseFirst(ct.units_full[i]) + ' (' + ct.units[i] + ')</option>';
 }
 html += '</select> <div class="value"><p class="v" id="cc-to-vt">0</p> <p class="u" id="cc-to-ut">' + ct.units[curTo] + '</p></div></div>';
 c.innerHTML = html;
 convert();
}

function changeFromUnit(fromSwitch = false) {
 let u = document.getElementById('cc-from-u');
 let ut = document.getElementById('cc-from-ut');
 let u0 = document.getElementById('cc-to-u');
 if (u.value === u0.value) {
  u0.value = curFrom;
  changeToUnit();
 }
 ut.innerText = conv[t.value].units[u.value];
 curFrom = Number(u.value);
 if (fromSwitch) {
  convert();
 }
}

function changeToUnit(fromSwitch = false) {
 let u = document.getElementById('cc-to-u');
 let ut = document.getElementById('cc-to-ut');
 let u0 = document.getElementById('cc-from-u');
 if (u.value === u0.value) {
  u0.value = curTo;
  changeFromUnit();
 }
 ut.innerText = conv[t.value].units[u.value];
 curTo = Number(u.value);
 if (fromSwitch) {
  convert();
 }
}

function convert() {
 let from = document.getElementById('cc-from-v');
 let fromu = document.getElementById('cc-from-u');
 let to = document.getElementById('cc-to-vt');
 let tou = document.getElementById('cc-to-u');
 let f = conv[t.value].units[fromu.value];
 let tt = conv[t.value].units[tou.value];
 let formula = conv[t.value].formulas[f + '-' + tt];
 let task = formula.replaceAll('$', from.value);
 let result = eval(task);
 to.innerText = result;
}

function showSettings() {
 document.getElementById('settings').style.display = 'block';
 let btn = document.getElementById('settings-btn');
 btn.onclick = closeSettings;
 btn.classList.add('opened');
 btn.innerText = '×';
}

function closeSettings() {
 document.getElementById('settings').style.display = 'none';
 let btn = document.getElementById('settings-btn');
 btn.onclick = showSettings;
 btn.classList.remove('opened');
 btn.innerText = '';
}

function showVersionChanges() {
 document.getElementById('changes').style.display = 'block';
}

function closeVersionChanges() {
 document.getElementById('changes').style.display = 'none';
}

document.getElementById('settings-custom-conv-data-inp').onchange = function() {
 let btn = document.getElementById('settings-custom-conv-data-btn');
 if (this.files[0]) {
  btn.disabled = false;
 } else {
  btn.disabled = true;
 }
}

function loadCustomConvertData() {
 let inp = document.getElementById('settings-custom-conv-data-inp');
 let f = inp.files[0];
 if (!f) {
  alert('Загруженный JSON-файл отсутствует!');
  return false;
 }
 let rdr = new FileReader();
 rdr.readAsText(f);
 rdr.onerror = function() {
  alert('Не удалось прочитать JSON-файл.');
  return false;
 }
 rdr.onload = function() {
  let res = rdr.result;
  let j;
  try {
   j = JSON.parse(res);
  } catch (e) {
   alert('Не удалось обработать JSON.\n\n' + e.message);
   return false;
  }
  if (!j['data']) {
   alert('В JSON отсутствует поле «data».');
   return false;
  }
  let d = j.data;
  if (j.format === 1) {
   conv = j.data;
  } else {
   alert('Неподдерживаемый формат JSON-пакета: ' + j.format);
   return false;
  }
  inp.value = null;
  document.getElementById('settings-custom-conv-data-btn').disabled = true;
  document.getElementById('settings-reset-conv-data-btn').disabled = false;
  updateTypes();
  changeConverter();
 }
}

function resetConvertData() {
 conv = defaultConvData;
 updateTypes();
 changeConverter();
 document.getElementById('settings-reset-conv-data-btn').disabled = true;
 document.getElementById('settings-custom-conv-data-inp').value = null;
}

function upperCaseFirst(str) {
 return str[0].toUpperCase() + str.slice(1);
}

updateTypes();
changeConverter();
  </script>
 </body>
</html>